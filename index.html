<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ustarp969GAME</title>
<style>
  html,body{
    margin:0;
    height:100%;
    overflow:hidden;
    background:linear-gradient(#b9e6ff,#ffe6f0);
    font-family: 'Arial', sans-serif;
  }

  /* ゲームキャンバス設定 */
  #wrap{position:fixed;inset:0;}
  #bg,#stage{
    position:absolute;
    top:0;left:0;right:0;bottom:0;
    margin:auto;
    width:400px;height:720px;
    display:block;
  }
  #bg{z-index:1;}
  #stage{z-index:2;}

  /* UI */
  #hud{
    position:fixed;
    top:10px;left:10px;right:10px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-weight:700;
    color:#222;
    z-index:3;
  }
  button{
    border:none;
    border-radius:10px;
    padding:10px 14px;
    font-size:14px;
    font-weight:bold;
    cursor:pointer;
  }
  #drop{background:#ff6ca5;color:white;}
  #retry{background:#86d3ff;color:#003;}
  #title{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    font-size:32px;
    color:white;
    font-weight:900;
    text-shadow:2px 2px 6px #0005;
    z-index:4;
  }
</style>
</head>
<body>
<div id="wrap">
  <canvas id="bg"></canvas>
  <canvas id="stage"></canvas>
  <div id="hud">
    <div>SCORE <span id="score">0</span></div>
    <div>
      <button id="drop">DROP</button>
      <button id="retry">Retry</button>
    </div>
  </div>
  <div id="title">ustarp969GAME</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>
<script>
const { Engine, Render, Runner, World, Bodies, Body, Events } = Matter;
const stage = document.getElementById("stage");
const engine = Engine.create();
const world = engine.world;
const render = Render.create({
  canvas: stage,
  engine: engine,
  options: { width: 400, height: 720, background: "transparent", wireframes: false }
});
Render.run(render);
const runner = Runner.create();
Runner.run(runner, engine);

let score = 0;
const scoreEl = document.getElementById("score");

const ground = Bodies.rectangle(200, 710, 400, 40, { isStatic: true, render: { fillStyle: "#222" } });
World.add(world, ground);

// バイク台
const bike = Bodies.rectangle(200, 660, 140, 20, { isStatic: true, render: { sprite: { texture: "bike.png", xScale: 0.3, yScale: 0.3 } } });
World.add(world, bike);

const blockImages = ["I.PNG","J.PNG","L.PNG","O.PNG","S.PNG","T.PNG"];
let currentBlock = null;

function spawnBlock() {
  const img = blockImages[Math.floor(Math.random() * blockImages.length)];
  const x = 200 + (Math.random() * 100 - 50);
  currentBlock = Bodies.rectangle(x, 100, 60, 80, {
    render: { sprite: { texture: img, xScale: 0.25, yScale: 0.25 } }
  });
  World.add(world, currentBlock);
}

function dropBlock() {
  if (!currentBlock) return;
  Body.setStatic(currentBlock, false);
  currentBlock = null;
  score++;
  scoreEl.textContent = score;
  setTimeout(spawnBlock, 1000);
}

document.getElementById("drop").onclick = dropBlock;
document.getElementById("retry").onclick = () => location.reload();

// 初期ブロック生成
spawnBlock();

// BGM再生
let bgm;
document.body.addEventListener("click", () => {
  if (!bgm) {
    bgm = new Audio("bgm.mp3");
    bgm.loop = true;
    bgm.volume = 0.5;
    bgm.play();
  }
});
</script>
</body>
</html>
