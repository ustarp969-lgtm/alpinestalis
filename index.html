<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>ustarp969GAME – Living Hand</title>
<style>
html,body{
  margin:0;
  background:#0c1218;
  color:#fff;
  overflow:hidden;
  font-family:sans-serif;
}
#hud{position:absolute;top:10px;left:10px;z-index:10}
#score{font-weight:800}
canvas{display:block;margin:auto;background:linear-gradient(180deg,#bfe7ff,#eaf6ff 60%,#ffe1ee)}
#over{
  position:absolute;inset:0;display:none;
  align-items:center;justify-content:center;
  flex-direction:column;
  background:rgba(0,0,0,.6);
  color:#fff;font-size:36px;font-weight:900;
  text-shadow:0 3px 10px #000;
  z-index:20;
}
button{
  position:absolute;top:10px;right:10px;
  background:#ff5c97;color:#fff;border:none;padding:10px 14px;border-radius:10px;font-weight:700;
}
</style>
</head>
<body>
<div id="hud"><span id="score">SCORE 0</span></div>
<button id="retry">Retry</button>
<canvas id="stage" width="420" height="720"></canvas>
<div id="over">GAME OVER</div>
<script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>
<script>
const {Engine,Render,Runner,World,Bodies,Body,Events,Composite,Vertices}=Matter;
const W=420,H=720;
const canvas=document.getElementById('stage');
const engine=Engine.create({gravity:{x:0,y:.95}});
const render=Render.create({canvas,engine,options:{width:W,height:H,wireframes:false,background:'transparent'}});
Render.run(render);
Runner.run(Runner.create(),engine);

/* ========== 音 ========== */
let AC=null, master=null;
const startAudio=()=>{
  if(AC)return;
  const C=window.AudioContext||window.webkitAudioContext;
  AC=new C();master=AC.createGain();master.gain.value=.2;master.connect(AC.destination);
}
function tone(f,len=.2,vol=.2,type='sine'){
  if(!AC)return;
  const o=AC.createOscillator(),g=AC.createGain();
  o.type=type;o.frequency.value=f;o.connect(g);g.connect(master);
  const t=AC.currentTime;
  g.gain.setValueAtTime(0.001,t);g.gain.linearRampToValueAtTime(vol,t+.02);
  g.gain.exponentialRampToValueAtTime(0.001,t+len);
  o.start(t);o.stop(t+len+.02);
}
const SFX={
  catch(){tone(440,.1,.2,'square');tone(660,.1,.2,'triangle');},
  over(){tone(330,.3,.3,'sawtooth');setTimeout(()=>tone(220,.5,.2,'triangle'),300);}
}

/* ========== ブロック ========== */
function createBlock(x=W/2,y=80){
  const color=['#ff7b7b','#7bafff','#7bff9c'][Math.floor(Math.random()*3)];
  const b=Bodies.rectangle(x,y,50,50,{render:{fillStyle:color}});
  World.add(engine.world,b);
  return b;
}
let block=createBlock();

/* ========== 手のひら ========== */
let handVerts=[
  Vertices.fromPath("M-80 0 -50 -20 -20 -10 0 0 20 10 40 30 60 20 80 0 60 40 20 60 -20 50 -60 30"),
  Vertices.fromPath("M-90 0 -60 -10 -30 -20 0 -5 30 10 50 30 70 20 80 0 50 50 10 60 -40 40 -70 20"),
  Vertices.fromPath("M-70 0 -40 -10 -10 -5 20 0 40 10 60 30 50 50 10 60 -40 40 -70 20"),
  Vertices.fromPath("M-80 0 -50 -10 -20 -5 10 0 30 10 50 30 70 20 60 40 20 60 -30 50 -70 20")
];
function createHand(){
  const v=handVerts[Math.floor(Math.random()*handVerts.length)];
  const h=Bodies.fromVertices(W/2,580,v,{
    isStatic:true,
    render:{fillStyle:"#f4c49b",strokeStyle:"#000",lineWidth:2}
  });
  return h;
}
let hand=createHand();
World.add(engine.world,hand);

/* ========== スコア＆ゲーム状態 ========== */
let score=0,over=false;
function setScore(n){score=n;document.getElementById('score').textContent="SCORE "+n;}
function reset(){
  Composite.allBodies(engine.world).forEach(b=>{
    if(b!==hand)World.remove(engine.world,b);
  });
  World.remove(engine.world,hand);
  hand=createHand();
  World.add(engine.world,hand);
  block=createBlock();
  over=false;setScore(0);
  document.getElementById('over').style.display='none';
}

/* ========== 手のアニメーション ========== */
let handPhase=0;
Events.on(engine,'beforeUpdate',()=>{
  if(over)return;
  handPhase+=0.02;
  const scale=1+Math.sin(handPhase)*0.05;
  Body.scale(hand,scale,1,hand.position);
});

/* ========== 衝突処理 ========== */
Events.on(engine,'collisionStart',e=>{
  for(let p of e.pairs){
    if((p.bodyA===block&&p.bodyB===hand)||(p.bodyB===block&&p.bodyA===hand)){
      SFX.catch();
      setScore(score+1);
      World.remove(engine.world,block);
      block=createBlock();
    }
  }
});
Events.on(engine,'afterUpdate',()=>{
  if(block.position.y>H+50&&!over){
    over=true;
    document.getElementById('over').style.display='flex';
    SFX.over();
  }
});

/* ========== 入力 ========== */
canvas.addEventListener('pointerdown',()=>startAudio());
document.getElementById('retry').onclick=reset;

/* ========== 初期化 ========== */
setScore(0);
</script>
</body>
</html>
