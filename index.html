<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>Alpinestars Tetris (Touch + Keyboard)</title>
<style>
  html,body{margin:0;height:100%;background:#0b1020;color:#fff;font-family:system-ui,-apple-system,sans-serif;overflow:hidden}
  #wrap{display:flex;justify-content:center;align-items:center;height:100%}
  canvas{background:#0a1224;box-shadow:0 10px 30px rgba(0,0,0,.5);border-radius:12px}
  #ui{position:fixed;top:8px;left:8px;font-weight:700;text-shadow:0 2px 6px rgba(0,0,0,.6)}
  #ui small{opacity:.8}
  /* タッチ操作ゾーン（透明だけど薄く見える） */
  #pads{position:fixed;inset:0;pointer-events:none}
  .pad{pointer-events:auto;position:absolute}
  #padL{left:0;bottom:0;width:33vw;height:35vh;background:rgba(255,255,255,.04)}
  #padR{right:0;bottom:0;width:33vw;height:35vh;background:rgba(255,255,255,.06)}
  #padRot{left:0;top:0;width:100vw;height:30vh;background:rgba(255,255,255,.03)}
  #padDrop{left:33vw;bottom:0;width:34vw;height:35vh;background:rgba(255,255,255,.02)}
</style>
</head>
<body>
<div id="wrap"><canvas id="cv" width="300" height="600"></canvas></div>
<div id="ui">
  <div id="score">SCORE 0</div>
  <small>← →：移動 / ↑：回転 / space：落下（スマホは画面左右/上タップ）</small>
</div>
<div id="pads">
  <div id="padL" class="pad" title="Left"></div>
  <div id="padR" class="pad" title="Right"></div>
  <div id="padRot" class="pad" title="Rotate"></div>
  <div id="padDrop" class="pad" title="Drop"></div>
</div>

<script>
// ===== 盤面設定 =====
const COLS=10, ROWS=20, SIZE=30;
const cv=document.getElementById("cv"), cx=cv.getContext("2d");
cv.width = COLS*SIZE; cv.height = ROWS*SIZE;
let board = Array.from({length:ROWS},()=>Array(COLS).fill(0));
let score=0;

// ===== 形（I,O,T,L,J,S の6種） =====
const SHAPES = {
  I: [[1,1,1,1]],
  O: [[1,1],[1,1]],
  T: [[0,1,0],[1,1,1]],
  L: [[1,0,0],[1,1,1]],
  J: [[0,0,1],[1,1,1]],
  S: [[0,1,1],[1,1,0]]
};
const COLORS = {I:"#39e",O:"#fc3",T:"#c4f",L:"#f80",J:"#06f",S:"#0f6"};
const NAMES = Object.keys(SHAPES);

// ===== 画像（任意）: img/I.png などがあれば自動使用 =====
const IMG = {};
function loadImages(){
  return Promise.all(NAMES.map(n=>new Promise(res=>{
    const im=new Image();
    im.onload=()=>{ IMG[n]=im; res(); };
    im.onerror=()=>{ IMG[n]=null; res(); };
    im.src = `img/${n}.png`;
  })));
}

// ===== ピース生成 =====
function newPiece(){
  const t = NAMES[(Math.random()*NAMES.length)|0];
  return { t, m: SHAPES[t].map(r=>r.slice()), x:3, y:0 };
}
let cur = newPiece();

// ===== 回転 =====
function rot(m){
  const h=m.length, w=m[0].length;
  const r=[...Array(w)].map(()=>Array(h).fill(0));
  for(let y=0;y<h;y++) for(let x=0;x<w;x++) r[x][h-1-y]=m[y][x];
  return r;
}

// ===== 衝突判定 =====
function coll(m, px, py){
  for(let y=0;y<m.length;y++) for(let x=0;x<m[0].length;x++){
    if(!m[y][x]) continue;
    const nx=px+x, ny=py+y;
    if(nx<0 || nx>=COLS || ny>=ROWS) return true;
    if(ny>=0 && board[ny][nx]) return true;
  }
  return false;
}

// ===== 固定 & ライン消去 =====
function merge(){
  for(let y=0;y<cur.m.length;y++) for(let x=0;x<cur.m[0].length;x++){
    if(cur.m[y][x]) board[cur.y+y][cur.x+x]=cur.t;
  }
  // ライン消し
  for(let y=ROWS-1;y>=0;y--){
    if(board[y].every(v=>v)){
      board.splice(y,1);
      board.unshift(Array(COLS).fill(0));
      score += 100;
      document.getElementById('score').textContent = `SCORE ${score}`;
      y++;
    }
  }
  cur = newPiece();
  if(coll(cur.m,cur.x,cur.y)){ // ゲームオーバー
